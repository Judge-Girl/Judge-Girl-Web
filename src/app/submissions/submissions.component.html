<!-- Spinner -->
<div *ngIf="loadingSubmissions" class="row w-100 h-100 align-items-center justify-content-center">
  <ld-circle></ld-circle>
</div>


<div *ngIf="studentService.tryLogin() | async" class="my-panel">
  <p *ngIf="!bestRecord">You have not submitted to this problem yet.</p>

  <p *ngIf="bestRecord" id="best-record-label">Best Record</p>
  <span *ngIf="ifTheBestSubmissionStatusIs(AC)" class="badge badge-success judge-status">AC</span>
  <span *ngIf="ifTheBestSubmissionStatusIs(RE)" class="badge badge-danger judge-status">RE</span>
  <span *ngIf="ifTheBestSubmissionStatusIs(MLE)" class="badge badge-warning judge-status">MLE</span>
  <span *ngIf="ifTheBestSubmissionStatusIs(TLE)" class="badge badge-warning judge-status">TLE</span>
  <span *ngIf="ifTheBestSubmissionStatusIs(CE)" class="badge badge-danger judge-status">CE</span>
  <span *ngIf="ifTheBestSubmissionStatusIs(WA)" class="badge badge-danger judge-status">WA</span>

  <p *ngIf="bestRecord" class="text">Total Grade: {{bestRecord.totalGrade}}&nbsp;pt</p>

  <table *ngIf="submissions.length != 0" class="table" id="submissions-table">
    <thead id="submission-table-header" [style.fontSize]="'14px'">
    <tr>
      <th scope="col" [width]="'100px'">Time</th>
      <th scope="col" [width]="'60px'">Status</th>
      <th scope="col" [width]="'60px'">Avg Runtime</th>
      <th scope="col" [width]="'60px'">Avg Memory</th>
      <th scope="col" [width]="'60px'">Total Grade</th>
      <th scope="col" [width]="'80px'">View Judges</th>
      <th scope="col" [width]="'80px'">View Codes</th>
    </tr>
    </thead>
    <tbody class="submissions-table">
    <tr *ngFor="let submission of submissions">
      <td>{{describeTimeFromNow(submission.submissionTime)}}</td>

      <!-- Show loading during the judge uncompleted-->
      <td *ngIf="!isJudged(submission)">
        <div class="spinner-border text-primary" role="status" id="spinner">
          <span class="sr-only">Loading...</span>
        </div>
      </td>
      <!-- Empty field placeholders during the judge uncompleted -->
      <td *ngIf="!isJudged(submission)"></td>
      <td *ngIf="!isJudged(submission)"></td>
      <td *ngIf="!isJudged(submission)"></td>

      <!-- Info that only available after the judge completed-->
      <td *ngIf="isJudged(submission)"
          class="{{submission.summaryStatus}}">{{submission.summaryStatus}}</td>
      <td *ngIf="isJudged(submission)">{{avgRuntime(submission) ? avgRuntime(submission) : '--'}} ms</td>
      <td *ngIf="isJudged(submission)">{{avgMemory(submission) ? avgMemory(submission) : '--'}} B</td>
      <td *ngIf="isJudged(submission)">{{submission.totalGrade}} pt</td>
      <td>
        <button *ngIf="isJudged(submission)" type="button" class="btn btn-link see-details-btn" data-toggle="modal"
                (click)="onViewSubmissionJudgesBtnClick(submission)"
                data-target="#submission-judges-modal">
          View Judges
        </button>
      </td>

      <!-- Codes are available when it's submitted -->
      <td>
        <button type="button" class="btn btn-link see-details-btn" data-toggle="modal"
                (click)="onViewSubmissionCodesBtnClick(submission)"
                data-target="#submission-codes-modal">
          View Codes
        </button>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<!-- View Judges Modal -->
<div [hidden]="!viewingJudgesSubmission" class="modal fade" id="submission-judges-modal" tabindex="-1" role="dialog"
     aria-labelledby="submission-judges-modal-title" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="submission-judges-modal-title">Submission Judges</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="table" id="submission-judges-table">
          <thead class="modal-title" id="submission-judges-table-header" [style.fontSize]="'14px'">
          <tr>
            <th scope="col">Test Case</th>
            <th scope="col">Status</th>
            <th scope="col">Runtime</th>
            <th scope="col">Memory</th>
            <th scope="col">Grade</th>
            <th scope="col"></th>
          </tr>
          </thead>
          <tbody class="submissions-table">
          <tr *ngFor="let judge of viewingJudgesSubmission?.judges; let i = index">
            <td [width]="'80px'" scope="row">{{testCases[i].name}}</td>
            <td [width]="'50px'" class="{{judge.status}}">{{judge.status}}</td>
            <td [width]="'50px'">{{judge.status === CE ? '--' : judge.runtime}} ms</td>
            <td [width]="'50px'">{{judge.status === CE ? '--' : judge.memory}} B</td>
            <td [width]="'50px'">{{judge.grade}} pt</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<div [hidden]="!viewingCodesSubmission" class="modal fade" id="submission-codes-modal" tabindex="-1" role="dialog"
     aria-labelledby="submission-judges-modal-title" aria-hidden="true">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="submission-codes-modal-title">Submission Codes</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Spinner -->
        <div [hidden]="!loadingSubmittedCodes" class="row w-100 h-100 align-items-center justify-content-center">
          <ld-circle></ld-circle>
        </div>
        <div [hidden]="loadingSubmittedCodes">
          <div *ngFor="let code of viewingSubmittedCodes;" class="card">
            <div class="card-body">
              <h5 class="card-title">{{code.fileName}}</h5>
              <textarea  class="card-text" #codeArea>{{code.content}}</textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

